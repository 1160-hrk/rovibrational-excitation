# Rovibrational Excitation テストファイル カタログ

## 概要

このドキュメントは、rovibrational-excitationパッケージの全テストファイルの内容と目的を詳細に説明します。各テストファイルが何をテストしているか、どのような物理的検証を行っているかを体系的にまとめています。

## テストファイル一覧

### 基底クラステスト

#### `test_basis.py`
**目的**: LinMolBasisクラスの拡張テスト
- LinMolBasisの初期化パラメータの検証
- 基底状態の生成とインデックス変換
- use_M=True/Falseでの動作確認
- エラーハンドリング

#### `test_basis_twolevel.py`
**目的**: TwoLevelBasisクラスのテスト
- 2レベルシステムの基底関数
- エネルギーギャップの設定
- 単位変換の検証

#### `test_basis_viblad.py`
**目的**: VibLadderBasisクラスのテスト
- 振動ラダー基底の生成
- 調和振動子とMorse振動子の違い
- 振動量子数の配列操作

#### `test_basis_unified_units.py`
**目的**: 基底クラスの単位統一テスト
- 全基底クラスでの単位変換一貫性
- エネルギー単位（J）と周波数単位（rad/fs）の相互変換
- 物理的なエネルギースケールの妥当性チェック

### コア機能テスト

#### `test_electric_field.py`
**目的**: ElectricFieldクラスと関連関数のテスト
- 電場の生成と重ね合わせ
- ガウシアンパルスの生成
- 分散補正機能（GDD/TOD）
- 複雑な変調機能

#### `test_states.py`
**目的**: StateVectorとDensityMatrixクラスのテスト
- 量子状態の表現と操作
- 純粋状態と混合状態の変換
- 密度行列の物理的性質（エルミート性、トレース）

#### `test_hamiltonian.py`
**目的**: ハミルトニアン生成関数のテスト（非推奨機能）
- 後方互換性の確認
- 旧式のハミルトニアン生成インターフェース

### 双極子系テスト

#### `test_dipole_comprehensive.py`
**目的**: 双極子系の包括的テスト
- VibLadderDipoleMatrixの詳細テスト
- 回転双極子（JM結合）の検証
- Morse振動遷移の物理的妥当性
- エラーハンドリング

#### `test_dipole_linmol.py`
**目的**: LinMol双極子行列の詳細テスト
- 線形分子の双極子行列生成
- 異なる潜在ポテンシャルでの動作
- CuPyバックエンドとの一貫性
- スパース行列対応

#### `test_twolevel_dipole.py`
**目的**: TwoLevel双極子行列の包括的テスト
- 2レベルシステムの双極子行列
- μx, μy, μzの構造確認
- 物理的対称性の検証

#### `test_jm_wigner_equivalence.py`
**目的**: JM双極子とWigner係数の等価性確認
- 解析的実装とWigner-3j係数の比較
- 回転角運動量の選択則
- 高精度での数値一致確認

### 伝播アルゴリズムテスト

#### `test_propagator.py`
**目的**: 高レベル伝播関数のテスト
- schrodinger_propagation関数の検証
- mixed_state_propagation関数の検証
- liouville_propagation関数の検証
- 異なるバックエンドでの一貫性

#### `test_rk4_schrodinger.py`
**目的**: RK4 Schrodinger伝播のテスト
- 4次ルンゲ・クッタ法の実装検証
- ノルム保存の確認
- 基本的な動作確認

#### `test_rk4_lvne.py`
**目的**: RK4 Liouville-von Neumann伝播のテスト
- 密度行列の時間発展
- トレース保存の確認
- エルミート性の保持

#### `test_splitop_schrodinger.py`
**目的**: Split-Operator伝播のテスト
- 分割演算子法の実装
- 運動項と位置項の分離
- 高精度な時間発展

#### `test_rk4_comprehensive.py`
**目的**: RK4伝播機の包括的テスト
- CuPyバックエンドの検証
- エラーハンドリング
- 高度オプション（renorm、stride）
- 境界条件とエッジケース

#### `test_rk4_basic.py`
**目的**: RK4基本機能テスト
- 基本的なRK4実装の確認
- ノルム保存とトレース保存
- 電場エラーハンドリング

#### `test_low_level_propagators.py`
**目的**: 低レベル伝播機の詳細テスト
- RK4 Schrödinger、RK4 Liouville-von Neumann、Split-Operatorの数値精度
- 物理的妥当性の詳細検証
- アルゴリズム間の比較

### 統合・システムテスト

#### `test_integration.py` - 物理的検証の詳細
**目的**: 複数モジュール間の統合テストと物理的妥当性の検証

##### 1. 完全なシミュレーションワークフロー検証
**テスト**: `test_full_simulation_workflow()`
- **物理的検証内容**:
  - ノルム保存の確認（量子力学の基本要求）
  - 初期状態の正確な再現
  - 時間発展の数値安定性
- **統合要素**:
  - 基底セットアップ → ハミルトニアン生成 → 双極子行列 → 電場設定 → 時間発展

##### 2. 多準位励起の物理的検証
**テスト**: `test_multi_level_excitation()` [XFAIL]
- **物理的検証内容**:
  - 強い電場での多準位間遷移
  - 基底状態からの励起確認
  - 励起状態へのポピュレーション移動
- **期待される物理現象**:
  - 共鳴条件での効率的な励起
  - ポピュレーションの保存則

##### 3. 混合状態と純粋状態の比較検証
**テスト**: `test_mixed_vs_pure_states()` [XFAIL]
- **物理的検証内容**:
  - 純粋状態の時間発展
  - 同等な混合状態の時間発展
  - 密度行列表現での一致確認
- **量子力学的意義**:
  - 純粋状態|ψ⟩⟨ψ|と混合状態ρの等価性
  - 対角成分（ポピュレーション）の一致

##### 4. LiouvilleとSchrödinger方程式の比較
**テスト**: `test_liouville_vs_schrodinger()` [XFAIL]
- **物理的検証内容**:
  - Schrödinger方程式による状態発展
  - Liouville方程式による密度行列発展
  - 純粋状態での結果一致
- **理論的背景**:
  - i∂ψ/∂t = Hψ vs ∂ρ/∂t = -i[H,ρ]
  - 密度行列表現での等価性

##### 5. エネルギー保存の検証
**テスト**: `test_energy_conservation()`
- **物理的検証内容**:
  - 電場なしでの自由発展
  - エネルギー期待値の時間不変性
  - 相対誤差による厳密な評価
- **保存則の確認**:
  - ⟨H⟩ = ⟨ψ|H|ψ⟩ = const

##### 6. ポピュレーションダイナミクス
**テスト**: `test_population_dynamics()` [XFAIL]
- **物理的検証内容**:
  - 共鳴パルスによる励起
  - 基底状態と励起状態のポピュレーション変化
  - 総ポピュレーションの保存
- **検証する物理現象**:
  - ラビ振動
  - π/2パルスによる遷移

##### 7. コヒーレント vs インコヒーレント過程
**テスト**: `test_coherent_vs_incoherent()` [XFAIL]
- **物理的検証内容**:
  - コヒーレント状態（重ね合わせ）の発展
  - インコヒーレント状態（統計混合）の発展
  - 対角成分（ポピュレーション）と非対角成分（コヒーレンス）の違い
- **量子光学的意義**:
  - コヒーレンス効果の検証
  - 統計混合と量子重ね合わせの区別

##### 8. 電場強度スケーリング
**テスト**: `test_field_strength_scaling()` [XFAIL]
- **物理的検証内容**:
  - 異なる電場強度での励起効率
  - 摂動論的領域での線形応答
  - 強結合領域での非線形効果
- **物理的予測**:
  - 弱電場: 励起確率 ∝ E²
  - 強電場: ラビ振動

##### 9. 基底状態の一貫性
**テスト**: `test_basis_state_consistency()`
- **物理的検証内容**:
  - StateVectorとDensityMatrixの一貫性
  - 基底状態の密度行列表現
  - 異なる表現での物理的等価性

##### 10. 数値精度と長時間安定性
**テスト**: `test_numerical_precision()`
- **物理的検証内容**:
  - 長時間伝播でのノルム保存
  - 弱電場での数値安定性
  - 最終状態の物理的妥当性
- **数値計算の検証**:
  - 累積誤差の評価
  - 物理保存則の維持

### 無次元化・単位変換テスト

#### `test_nondimensional_consistency.py`
**目的**: 無次元化の一致性テスト
- 次元ありと無次元化での結果一致
- 時間発展軌道の一貫性
- 弱電場での高精度一致

#### `test_nondimensionalize.py`
**目的**: 無次元化システムの基本テスト
- NondimensionalizationScalesクラス
- 無次元化システムの生成
- 現実的パラメータでの検証

#### `test_unit_conversions.py`
**目的**: 単位変換の包括的テスト
- 物理定数の一貫性
- 異なる単位系での変換
- 数値精度の検証

#### `test_unit_consistency.py`
**目的**: 単位の一貫性テスト
- ハミルトニアンの単位統一
- 無次元化の単位オプション
- 物理レジーム分析

### パフォーマンス・スケーラビリティテスト

#### `test_performance.py`
**目的**: パフォーマンスとスケーラビリティのテスト
- 大規模システムでの実行時間
- メモリ使用量の効率性
- 長時間発展での数値安定性
- バックエンド間のパフォーマンス比較

### シミュレーション実行システムテスト

#### `test_simulation_runner.py`
**目的**: シミュレーション実行システムの包括的テスト
- CheckpointManagerの機能
- エラーハンドリングと再試行機能
- JSON安全性
- パラメータファイルの読み込み
- 並列実行
- 結果の保存と読み込み

#### `test_simulation_runner_basic.py`
**目的**: シミュレーション実行システムの基本テスト
- CheckpointManagerの基本操作
- JSON直列化
- パラメータ展開
- 基本ユーティリティ関数

#### `test_runner.py`
**目的**: シミュレーション実行システムのテスト
- 基本的なランナー機能
- 実行制御とエラーハンドリング

### その他の特殊テスト

#### `mock_objects.py`
**目的**: テスト用のモックオブジェクト
- テストに必要なダミーオブジェクト
- 軽量な代替実装

#### `run_tests.py`
**目的**: テスト実行用スクリプト
- 選択的テスト実行
- テスト結果の整理

## 物理的検証の階層構造

### レベル1: 基本物理法則
- ノルム保存（確率の保存）
- エネルギー保存（ハミルトニアンの対称性）
- トレース保存（密度行列の物理的意味）
- エルミート性（観測可能量の実数性）

### レベル2: 量子力学的過程
- 状態間遷移の選択則
- コヒーレンス効果
- 励起・脱励起過程
- 位相発展

### レベル3: 光物質相互作用
- 双極子遷移
- 共鳴条件
- ラビ振動
- 電場強度依存性

### レベル4: 数値計算の妥当性
- 長時間安定性
- 数値誤差の累積
- アルゴリズム間の一貫性
- 精度とパフォーマンスのトレードオフ

## 現在のXFAIL（期待される失敗）テスト

### 統合テスト関連
- `test_multi_level_excitation`: NaN値の発生
- `test_mixed_vs_pure_states`: 密度行列比較での不一致
- `test_coherent_vs_incoherent`: NaN値の発生
- `test_field_strength_scaling`: インデックスエラー
- `test_liouville_vs_schrodinger`: 再正規化による微小な差

### 無次元化関連
- `test_final_state_consistency`: 無次元化計算の不正確性
- `test_trajectory_consistency`: 無次元化計算の不正確性
- `test_weak_field_consistency`: 無次元化計算の不正確性

### パフォーマンス関連
- `test_very_large_system`: 戻り値の形状不一致
- `test_long_time_evolution`: 長時間発展でのノルム非保存
- `test_numerical_stability_large_system`: 大規模系でのエネルギー非保存

### プロパゲータ関連
- `test_schrodinger_propagation_with_constant_polarization`: 戻り値の形状不一致

### RK4関連
- `test_minimal_system_size`: 戻り値の形状不一致

## 今後の改善方向性

1. **XFAILテストの修正**: 根本的な数値計算問題の解決
2. **物理的検証の強化**: より厳密な物理法則の検証
3. **カバレッジの向上**: 未テスト領域の網羅
4. **パフォーマンス最適化**: 大規模システムでの効率化
5. **エラーハンドリング**: より堅牢なエラー処理

このカタログは、テストスイートの全体像を理解し、各テストの物理的意義を把握するための包括的な参考資料として機能します。 